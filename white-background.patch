@@ -732,6 +732,7 @@ function userphoto_options_page()
     $userphoto_level_moderated = get_option('userphoto_level_moderated');
     $userphoto_use_avatar_fallback = get_option('userphoto_use_avatar_fallback');
     $userphoto_override_avatar = get_option('userphoto_override_avatar');
+    $userphoto_white_transparency = get_option('userphoto_white_transparency');
 
     #Get new updated option values, and save them
     if (@$_POST['action'] == 'update') {
@@ -758,6 +759,9 @@ function userphoto_options_page()
         $userphoto_override_avatar = !empty($_POST['userphoto_override_avatar']);
         update_option('userphoto_override_avatar', $userphoto_override_avatar);
 
+        $userphoto_white_transparency = !empty($_POST['userphoto_white_transparency']);
+        update_option('userphoto_white_transparency', $userphoto_white_transparency);
+
         ?>
     <div id="message" class="updated fade"><p><strong><?php _e('Options saved.'); ?></strong></p></div>
     <?php
@@ -825,6 +829,15 @@ function userphoto_options_page()
                name="userphoto_jpeg_compression" value="<?php echo $userphoto_jpeg_compression ?>"/>%
         <?php echo $afterRow ?>
         <?php echo $beforeRow ?>
+        <label for="userphoto_white_transparency">
+            <?php _e('Fill with white instead of black', 'user-photo') ?>
+        </label>
+        <?php echo $betweenRow; ?>
+        <input type="checkbox" name="userphoto_white_transparency" id="userphoto_white_transparency" 
+                <?php if ($userphoto_white_transparency) echo ' checked="checked"'; ?> value="1" />
+        <?php _e("Change the color which replaces transparency during resize from black to white.", 'user-photo') ?>
+        <?php echo $afterRow; ?>
+        <?php echo $beforeRow ?>
         <label for="userphoto_admin_notified">
             <?php _e("Notify this administrator by email when user photo needs approval: ", 'user-photo') ?>
         </label>
@@ -922,6 +935,12 @@ function userphoto_resize_image($filename, $newFilename, $cropDetails, &$error)
         $full_dimension = get_option('userphoto_maximum_dimension');
 
         $imageresized = imagecreatetruecolor($cropDetails['tgtW'], $cropDetails['tgtH']);
+
+        if ( get_option( 'userphoto_white_transparency', false ) ) {
+            $backgroundColor = imagecolorallocate($imageresized, 255, 255, 255);
+            imagefill($imageresized, 0, 0, $backgroundColor);
+        }
+
         @ imagecopyresampled($imageresized, $image,
                              0, 0, $cropDetails['x'], $cropDetails['y'],
                              $cropDetails['tgtW'], $cropDetails['tgtH'], $cropDetails['w'], $cropDetails['h']);

